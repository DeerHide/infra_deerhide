services:
  nginx:
    image: "{{ nginx_docker_image_name }}:{{ nginx_docker_image_version }}"
    container_name: svc_nginx
    ports:
      - "8080:80"
    volumes:
      - "{{ nginx_data_dir }}:/var/www/html"
      - "{{ nginx_data_dir }}/default.conf:/etc/nginx/conf.d/default.conf"
    depends_on:
      - php

  php:
    build:
      context: ./php
    image: "svc_nginx_php:latest"
    container_name: svc_nginx_php
    volumes:
      - "{{ nginx_data_dir }}:/var/www/html"

  mysql:
    image: "{{ mysql_docker_image_name }}:{{ mysql_docker_image_version }}"
    container_name: svc_nginx_mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: app_db
    ports:
      - "3306:3306"
    volumes:
      - "nginx_mysql_data:/var/lib/mysql"
    restart: unless-stopped

volumes:
  nginx_mysql_data:
    driver: local
